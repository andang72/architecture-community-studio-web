<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title><%= title %></title>
  <style>
    #loader {
      transition: all 0.3s ease-in-out;
      opacity: 1;
      visibility: visible;
      position: fixed;
      height: 100vh;
      width: 100%;
      background: #fff;
      z-index: 90000;
    }

    #loader.fadeOut {
      opacity: 0;
      visibility: hidden;
    }

    .spinner {
      width: 40px;
      height: 40px;
      position: absolute;
      top: calc(50% - 20px);
      left: calc(50% - 20px);
      background-color: #333;
      border-radius: 100%;
      -webkit-animation: sk-scaleout 1.0s infinite ease-in-out;
      animation: sk-scaleout 1.0s infinite ease-in-out;
    }

    @-webkit-keyframes sk-scaleout {
      0% {
        -webkit-transform: scale(0)
      }

      100% {
        -webkit-transform: scale(1.0);
        opacity: 0;
      }
    }

    @keyframes sk-scaleout {
      0% {
        -webkit-transform: scale(0);
        transform: scale(0);
      }

      100% {
        -webkit-transform: scale(1.0);
        transform: scale(1.0);
        opacity: 0;
      }
    }

    .k-grid .u-link-underline>h5,
    .k-grid .u-link-underline>h4,
    .k-grid .u-link-underline>.u-title {
      border-bottom: 1px solid transparent;
      padding-bottom: 1.5px;
    }

    .is-loading {
      background-color: #fff;
      background-image: url('assets/static/images/loading-image.gif');
      background-repeat: no-repeat;
      background-position: center;
    }

    .is-loading img,
    .is-broken img {
      opacity: 0;
    }

    .tab-pane-grid .k-grid-toolbar {
      background: #fff;
    }

    .k-grid tbody tr {
      cursor: move;
    }

    .placeholder {
      outline-style: dashed;
      outline-width: 1px;
      outline-color: red;
    }

    .masonry {
      display: block;
      min-height: 600px;
    }

    .masonry:after {
      content: '';
      display: block;
      clear: both;
    }

    .masonry .card>a {
      width: 300px;
      overflow: hidden;
    }

    .masonry-item {
      float: left;
      border-radius: 5px;
    }

    .masonry-sizer,
    .masonry-item {
      width: 300px;
      overflow: hidden;
    }

    .masonry-item img.k-card-image {
      width: 300px;
      max-height: 300px;
      overflow: hidden;
    }

    .masonry-item .k-card-body {
      overflow-wrap: anywhere;
    }

/*
    #masonry-pager {
      position: absolute;
      bottom: 1px;
    }
    */
  </style>
</head>

<body class="app" authenticate-required="true">
  <!-- @TOC -->
  <!-- =================================================== -->
  <!--
      + @Page Loader
      + @App Content
          - #Left Sidebar
              > $Sidebar Header
              > $Sidebar Menu

          - #Main
              > $Topbar
              > $App Screen Content
    -->

  <!-- @Page Loader -->
  <!-- =================================================== -->
  <div id='loader'>
    <div class="spinner"></div>
  </div>

  <script>
    window.addEventListener('load', function load() {
      const loader = document.getElementById('loader');
      setTimeout(function () {
        loader.classList.add('fadeOut');
      }, 300);
    });
  </script>

  <!-- @App Content -->
  <!-- =================================================== -->
  <div>
    <!-- #Left Sidebar ==================== -->
    <%= require('html-loader!./include-sidebar.html') %>
    <!-- #Main ============================ -->
    <div class="page-container">
      <!-- ### $Topbar ### -->
      <%= require('html-loader!./include-topbar.html') %>
      <!-- ### $App Screen Content ### -->
      <script>
        function setup() {
          $('a.sidebar-link[href="resources-albums.html"]').addClass('actived');
          $('a.sidebar-link[href="resources-albums.html"]').closest('li.nav-item.dropdown').addClass('open'); 

          $(document).ajaxSend(function (event, jqXHR, options) {
            jqXHR.setRequestHeader('Authorization', studio.services.accounts.authHeader()['Authorization']);
          });

          var $window = $(window).on('resize', function () {
            var height = $(document).height() - ($('.header-container').height() + $('#masonry-pager').height())
            $('masonry-listview').css('min-height', height );
          }).trigger('resize'); //on page load     

          var renderTo = $("#mainContent");
          var observable = kendo.observable({
            create: function () {
              var $this = this;
              getAlbumWindow();
            },
            upload: function () {
              var $this = this;
              getUploadWindow($this);
            },
            masonry:false
          });
          kendo.bind(renderTo, observable);
          //createAlbumListView(observable);
          createAlbumMasonry(observable);
        }

        function createAlbumMasonry(observable) {
          var renderTo = $(".masonry");
          var template = kendo.template($("#listview-album-template").html());
          var AlbumModel = kendo.data.Model.define(studio.data.model.Album);
          var dataSource = new kendo.data.DataSource({
            transport: {
              read: { url: studio.services.getApiUrl('/data/secure/mgmt/albums'), type: 'post', dataType: 'json', contentType: "application/json; charset=utf-8" },
              parameterMap: function (options, operation) {
                if (operation !== "read" && options.models) {
                  return JSON.stringify(options.models);
                } else {
                  //options.tags = tags.value();
                }
                return JSON.stringify(options);
              }
            },
            pageSize: 54,
            serverPaging: true,
            serverFiltering: true,
            serverSorting: true,
            error: studio.ui.handleAjaxError,
            schema: {
              data: "items",
              total: "totalCount",
              model: AlbumModel
            },
            change: function () {
              $elems = kendo.render(template, this.view());
              renderTo.html($elems);
              
              if(observable.get('masonry'))
                renderTo.masonry('destroy');
              
              renderTo.masonry({ horizontalOrder: true, columnWidth: 300, percentPosition: false, gutter: 10 });
              observable.set('masonry', true);

              
              var delay = 500;
              renderTo.find("img[is-secure]").each(function () {
                var $this = $(this);
                $this.parent().addClass('is-loading');
                delay = delay + 1000;
                studio.ui.setSecureImage($this, delay, function () {
                  renderTo.masonry('layout');
                });
              });

              $("#" + renderTo.attr("id") + " figure img").one("load", function () {
                  var $this = $(this);
                  $this.parent().removeClass('is-loading');
                }).each(function () { });

              $(".masonry img.k-card-image").hover(function () {
                kendo.fx(this).zoom("in").startValue(1).endValue(1.2).play();
              }, function () {
                kendo.fx(this).zoom("out").endValue(1).startValue(1.2).play();
              });
              //renderTo.height('100%');
            }
          });

          dataSource.read();
          $("#masonry-pager").kendoPager({
            dataSource: dataSource,
            pageSizes: [54, 108, 162],
            refresh: true,
            responsive: true
          });
          renderTo.on("click", "a[data-action=edit]", function (e) {
            var $this = $(this);
            if (studio.ui.defined($this.data("object-id"))) {
              var objectId = $this.data("object-id");
              var dataItem = dataSource.get(objectId);
              getAlbumWindow(dataItem);
            }
          });
        }
ß
        function getUploadWindow(observable) {
          var renderTo = $('#upload-window');
          if (!renderTo.data("kendoWindow")) {
            var myDropzone = studio.ui.dropzone(
              "#image-file-dropzone", {
              url: studio.services.getApiUrl('/data/secure/mgmt/images/upload.json'),
              paramName: 'file',
              parallelUploads: 1,
              maxFilesize: 20,
              uploadMultiple: true,
              headers: studio.services.accounts.authHeader(),
              previewsContainer: '#image-file-dropzone .dropzone-previews',
              previewTemplate: '<div class="dz-preview dz-file-preview"><div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div></div>'
            });
            myDropzone.on("sending", function (file, xhr, formData) {});
            myDropzone.on("success", function (file, response) {
              file.previewElement.innerHTML = "";
              $.each(response, function (index, item) {
                studio.ui.notify(null, item.name + " is uploaded.", "success");
              });
            });
            myDropzone.on("maxfilesexceeded", function () {
              console.log("maxfilesexceeded");
            });
            myDropzone.on("addedfile", function (file) {
              kendo.ui.progress(renderTo, false);
              console.log("file added");
            });
            myDropzone.on("complete", function () {
              kendo.ui.progress(renderTo, false);
            });
            var window = renderTo.kendoWindow({
              width: "500px",
              title: "Upload",
              visible: false,
              scrollable: true,
              modal: true,
              actions: ["Close"], // 
              resize: function () {
                // the user has finished resizing the Window 
              },
              open: function () { },
              close: function () { }
            }).data('kendoWindow');

          }
          renderTo.data("kendoWindow").center().open();
        }

        function getAlbumWindow(item) {
          var renderTo = $('#album-window');
          if (!renderTo.data("kendoWindow")) {
            var renderToGrid = $('#album-image-grid');
            var AlbumModel = kendo.data.Model.define(studio.data.model.Album);
            var observable = kendo.observable({
              album: new AlbumModel(),
              editable: true,
              select: function () {
                var $this = this;
                getImageBroswerWindow(null, function (data) {
                  if (data) {
                    data.forEach(function (item) {
                      renderToGrid.data('kendoGrid').dataSource.add(item);
                    });
                  }
                });
              },
              saveOrUpdateImages: function () {
                var $this = this;
                var items = renderToGrid.data('kendoGrid').dataSource.data();
                var template = kendo.template('Update selected images.<br/> This action cannot be undone.');
                var dialog = $("#dialog").kendoDialog({
                  title: 'Are you sure you want to update album images ?',
                  content: template($this),
                  actions: [
                    {
                      text: 'Ok',
                      action: function (e) {
                        kendo.ui.progress($('.k-dialog'), true);
                        axios({
                          url: studio.services.getApiUrl('/data/secure/mgmt/albums/' + $this.album.albumId + '/images'),
                          method: "PUT",
                          data: JSON.stringify(items),
                          headers: studio.ui.headerWithAuth()
                        })
                          .then(response => {
                            const data = response.data;
                            renderToGrid.data('kendoGrid').dataSource.read();
                            studio.ui.notify(null, "image tag has been updated.", "success");
                          }).catch(function (error) {
                            studio.ui.handleAxiosError(error);
                          })
                          .then(function () {
                            kendo.ui.progress($('.k-dialog'), false);
                            dialog.close();
                          });
                        return false;
                      },
                      primary: true
                    },
                    { text: 'Cancle' }
                  ]
                }).data('kendoDialog');
                dialog.open();

              },
              saveOrUpdate: function () {
                var $this = this;
                var template = kendo.template("Save or Update the #: album.name #. This operation cannot be canceled.");
                var dialog = $("#dialog").kendoDialog({
                  width: "450px",
                  closable: true,
                  modal: true,
                  buttonLayout: "normal",
                  title: 'Update',
                  content: template($this),
                  actions: [
                    {
                      text: 'Ok',
                      action: function (e) {
                        kendo.ui.progress($('.k-dialog'), true);
                        axios({
                          url: studio.services.getApiUrl("/data/secure/mgmt/albums/0"),
                          method: "post",
                          data: JSON.stringify($this.album),
                          headers: studio.ui.headerWithAuth()
                        }).then(response => {
                          let data = response.data;
                          studio.ui.notify(null, $this.get('album.name') + " has been updated.", "success");
                          $this.setSource(new AlbumModel(data));
                          $this.set('updated', true);
                        }).catch(function (error) {
                          studio.ui.handleAxiosError(error);
                        }).then(function () {
                          // always executed 
                          kendo.ui.progress($('.k-dialog'), false);
                          dialog.close();
                        });
                        return false;
                      },
                      primary: true
                    },
                    { text: 'Cancle' }
                  ]
                }).data("kendoDialog");
                dialog.open();
              },
              setSource: function (data) {
                var $this = this;
                data = data || new AlbumModel();
                data.copy($this.album);
                $this.set('editable', $this.album.albumId > 0 ? true : false);
                if ($this.get('editable')) {
                  createAlbumImageGridIfNotExist(null, $this.album.albumId);
                }
              }
            });            
            
            var myDropzone = studio.ui.dropzone(
              "#album-image-file-dropzone", {
              url: studio.services.getApiUrl('/data/secure/mgmt/images/upload.json'),
              paramName: 'file',
              parallelUploads: 1,
              maxFilesize: 20,
              uploadMultiple: true,
              headers: studio.services.accounts.authHeader(),
              previewsContainer: '#album-image-file-dropzone .dropzone-previews',
              previewTemplate: '<div class="dz-preview dz-file-preview"><div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div></div>'
            });
            myDropzone.on("sending", function (file, xhr, formData) {});
            myDropzone.on("success", function (file, response) {
              file.previewElement.innerHTML = "";
              $.each(response, function (index, item) {
                studio.ui.notify(null, item.name + " is uploaded.", "success");
              });
            });
            myDropzone.on("maxfilesexceeded", function () {
              console.log("maxfilesexceeded");
            });
            myDropzone.on("addedfile", function (file) {
              kendo.ui.progress(renderTo, false);
              console.log("file added");
            });
            myDropzone.on("complete", function () {
              kendo.ui.progress(renderTo, false);
            });

            createAlbumImageGridIfNotExist(null, 0);
            
            kendo.bind(renderTo, observable);
            renderTo.data('model', observable);

            var window = renderTo.kendoWindow({
              width: "900px",
              title: "Album",
              visible: false,
              scrollable: true,
              modal: true,
              actions: ["Close"], // 
              resize: function () {
                // the user has finished resizing the Window 
                renderToGrid.height(renderTo.height());
                renderToGrid.data('kendoGrid').refresh();
              },
              open: function () { },
              close: function () { }
            }).data('kendoWindow');
          }
          renderTo.data('model').setSource(item);
          renderTo.data("kendoWindow").center().open();
        }

        /**
         * Image Broswer  Window.
         * renderTo : 윈도우를 생성할 대상 
         * callback : 
         */
        function getImageBroswerWindow(renderTo, callback) {
          renderTo = renderTo || $('#image-broswer-window');
          if (!renderTo.data("kendoWindow")) {
            var observable = kendo.observable({
              selected: false,
              selectedTags: [],
              select: function () {
                var $this = this;
                var selectedImages = [];
                grid.select().each(function () {
                  selectedImages.push(grid.dataItem(this));
                });
                if (studio.ui.isFunction(callback)) {
                  callback(selectedImages);
                  window.close();
                }
              }
            });
            var window = renderTo.kendoWindow({
              width: "950px",
              title: "Select Image",
              animation: false, //{ open: { effects: 'expand:vertical:fadeIn' }, close: { effects:'expand:vertical:fadeIn', reverse: true}},
              visible: false,
              scrollable: true,
              modal: true,
              actions: ["Close"],
              resize: function () {
                // the user has finished resizing the Window 
                renderToGrid.height(renderTo.height());
              },
              open: function () {
                grid.clearSelection();
                grid.dataSource.read();
              },
              close: function () {
              }
            }).data('kendoWindow');
            var renderToGrid = $("#" + renderTo.attr("id") + " .grid");
            var grid = renderToGrid.kendoGrid({
              dataSource: {
                transport: {
                  read: {
                    url: studio.services.getApiUrl('/data/secure/mgmt/images/list.json?fields=imageLink'),
                    type: 'post', contentType: "application/json; charset=utf-8"
                  },
                  parameterMap: function (options, operation) {
                    if (operation !== "read" && options.models) {
                      return JSON.stringify(options.models);
                    } else {
                      var tags = createTagSelect($("#tags"));
                      options.tags = tags.value();
                    }
                    return JSON.stringify(options);
                  }
                },
                pageSize: 50,
                serverPaging: true,
                serverFiltering: true,
                serverSorting: true,
                error: studio.ui.handleAjaxError,
                schema: {
                  total: "totalCount",
                  data: "items",
                  model: studio.data.model.Image
                }
              },
              toolbar: [{ template: kendo.template($('#imagebroswer-toolbar-template').html()) }],
              sortable: true,
              scrollable: true,
              persistSelection: true,
              filterable: true,
              pageable: {
                refresh: true,
                pageSizes: [50, 100, 200, 300, 400, 500, 1000]
              },
              change: function (e) {
                if (this.selectedKeyNames().length > 0) {
                  observable.set('selected', true);
                } else {
                  observable.set('selected', false);
                }
              },
              dataBound: function () {

                $("#" + renderTo.attr("id") + " figure img").one("load", function () {
                  var $this = $(this);
                  $this.parent().removeClass('is-loading');
                }).each(function () { });
 
                $("#" + renderTo.attr("id") + " figure img[is-secure]").each(function () {
                  var $this = $(this);
                  $this.parent().addClass('is-loading');
                  studio.ui.setSecureImage($this, 1000);
                }); 

              },
              noRecords: {
                template: "<p class='g-pa-20' >데이터가 로드되지 않았습니다. 잠시 후에 다시 데이터 새로고침 버튼을 클릭하여 주세요.</p>"
              },
              columns: [
                { selectable: true, width: "50px", headerAttributes: { "class": "text-center" }, attributes: { "class": "text-center" } },
                { field: "IMAGE_ID", title: "ID", filterable: true, sortable: true, width: 120, template: $('#imagebroswer-image-column-template').html(), attributes: { class: "text-center" } },
                { field: "OBJECT_TYPE", title: "OBJECT TYPE", filterable: true, sortable: true, width: 120, template: '#= objectType #', attributes: { class: "text-center" } },
                { field: "OBJECT_ID", title: "OBJECT ID", filterable: true, sortable: true, width: 120, template: '#= objectId #', attributes: { class: "text-center" } },
                { field: "FILE_NAME", title: "Image", filterable: true, sortable: true, template: '<span class="u-label g-rounded-3 g-bg-primary g-mr-10 g-mb-15">#:imageId#</span>#= name #' },
                { field: "FILE_SIZE", title: "Size", filterable: false, sortable: true, template: '#: studio.ui.format.byte(size)  #', attributes: { class: "text-center" }, width: 120 },
                { field: "USER_ID", title: "Creator", filterable: false, sortable: true, width: 150, template: $('#imagebroswer-user-column-template').html(), attributes: { class: "text-center" } },
                //{ field: "CREATION_DATE", title: "Creation Date", filterable: false, sortable: true, width: 100, template: '#: studio.ui.format.date( creationDate ,"yyyy.MM.dd")#', attributes: { class: "text-center" } },
                //{ field: "MODIFIED_DATE", title: "Modified Date", filterable: false, sortable: true, width: 100, template: '#: studio.ui.format.date( modifiedDate ,"yyyy.MM.dd")#', attributes: { class: "text-center" } }
              ]
            }).data('kendoGrid');

            var select = createTagSelect($('#select-tags'));

            kendo.bind(renderTo, observable);
          }
          renderTo.data("kendoWindow").center().open();
        }

        function createTagSelect(renderTo) {
          if (!renderTo.data('kendoMultiSelect')) {
            var select = renderTo.kendoMultiSelect({
              filter: "startswith",
              valuePrimitive: true,
              placeholder: 'Select tags...',
              dataTextField: "name",
              dataValueField: "tagId",
              dataSource: {
                transport: {
                  read: { url: studio.services.getApiUrl('/data/secure/mgmt/services/tags/list.json'), type: 'post', contentType: "application/json; charset=utf-8" },
                  create: { url: studio.services.getApiUrl('/data/secure/mgmt/services/tags/0/create.json'), type: 'post', contentType: "application/json; charset=utf-8" },
                  parameterMap: function (options, operation) {
                    return kendo.stringify(options);
                  }
                },
                error: studio.ui.handleAjaxError,
                schema: {
                  total: "totalCount",
                  data: "items",
                  model: {
                    id: "tagId",
                    fields: {
                      tagId: { type: "number", defaultValue: 0 },
                      name: { type: "string", defaultValue: null }
                    }
                  }
                }
              },
              noDataTemplate: $('#no-tag-data-template').html()
            }).data('kendoMultiSelect');
          }
          return renderTo.data('kendoMultiSelect');
        }

        function createAlbumImageGridIfNotExist(renderTo, objectId) {
          renderTo = renderTo || $('#album-image-grid');
          if (!renderTo.data("kendoGrid")) {
            var containerTarget = "#" + renderTo.attr('id') + "tbody";
            var grid = renderTo.kendoGrid({
              dataSource: [],
              toolbar: [{ template: kendo.template($('#gallery-toolbar-template').html()) }],
              scrollable: true,
              editable: false,
              pageable: {
                refresh: true,
                pageSizes: [50, 100, 200, 300, 400]
              },
              noRecords: {
                template: "<p class='g-pa-20' >No data.</p>"
              },
              columns: [
                { field: "Photo", width: "120px", headerAttributes: { "class": "text-center" }, attributes: { "class": "text-center" }, template: $('#order-column-template').html() },
                { field: "name", title: "File", filterable: false, sortable: true, template: $('#name-column-template').html() },
                { title: "&nbsp;", width: 150, headerAttributes: { "class": "text-center" }, attributes: { "class": "text-center" }, template: $('#command-column-template').html() }
              ],
              dataBound: function () {
                $("#" + renderTo.attr("id") + " figure img:not([is-secure])").one("load", function () {
                  var $this = $(this);
                  $this.parent().removeClass('is-loading');
                }).each(function () {
                  if (this.complete) {
                    // $(this).load(); // For jQuery < 3.0 
                    // $(this).trigger('load'); // For jQuery >= 3.0 
                  }
                });
                var delay = 600;
                $("#" + renderTo.attr("id") + " figure img[is-secure]").each(function () {
                  var $this = $(this);
                  $this.parent().addClass('is-loading');
                  studio.ui.setSecureImage($this, delay);
                  delay = delay + 100;
                });
              }
            }).data("kendoGrid");
            grid.table.kendoSortable({
              filter: ">tbody >tr",
              hint: function (element) { // Customize the hint.
                var table = $('<table style="width: 600px;" class="k-grid k-widget"></table>'),
                  hint;
                table.append(element.clone()); // Append the dragged element.
                table.css("opacity", 0.7);
                return table; // Return the hint element.
              },
              cursor: "move",
              placeholder: function (element) {
                return $('<tr colspan="3" class="placeholder"></tr>');
              },
              change: function (e) {
                var skip = grid.dataSource.skip(),
                  oldIndex = e.oldIndex + skip,
                  newIndex = e.newIndex + skip,
                  data = grid.dataSource.data(),
                  dataItem = grid.dataSource.getByUid(e.item.data("uid"));
                grid.dataSource.remove(dataItem);
                grid.dataSource.insert(newIndex, dataItem);
              }
            });
            renderTo.on("click", "button[data-action=remove]", function (e) {
              var $this = $(this);
              grid.removeRow($this.closest("tr"));
            });
            renderTo.on("click", "a[data-action=top]", function (e) {
              var $this = $(this);
              var row = $this.closest("tr");
              var dataItem = grid.dataItem(row);
              grid.dataSource.remove(dataItem);
              grid.dataSource.insert(0, dataItem);
            });
          }
          if (objectId > 0) {
            renderTo.data("kendoGrid").setDataSource(
              new kendo.data.DataSource(
                {
                  transport: {
                    read: {
                      url: studio.services.getApiUrl('/data/secure/mgmt/albums/') + objectId + '/images',
                      type: 'post',
                      contentType: "application/json"
                    },
                    parameterMap: function (options, operation) {
                      if (operation !== "read" && options.models) {
                        return JSON.stringify(options.models);
                      }
                      return JSON.stringify(options);
                    }
                  },
                  pageSize: 50,
                  serverPaging: false,
                  serverFiltering: false,
                  serverSorting: false,
                  error: studio.ui.handleAjaxError,
                  batch: true,
                  schema: {
                    total: "totalCount",
                    data: "items",
                    model: studio.data.model.Image
                  }
                }
              )
            );
          }
        }

        function createAlbumListView(observable) {
          var renderTo = $("#listview");
          var AlbumModel = kendo.data.Model.define(studio.data.model.Album);
          var dataSource = new kendo.data.DataSource({
            transport: {
              read: { url: studio.services.getApiUrl('/data/secure/mgmt/albums'), type: 'post', dataType: 'json', contentType: "application/json; charset=utf-8" },
              parameterMap: function (options, operation) {
                if (operation !== "read" && options.models) {
                  return JSON.stringify(options.models);
                } else {
                  //options.tags = tags.value();
                }
                return JSON.stringify(options);
              }
            },
            pageSize: 54,
            serverPaging: true,
            serverFiltering: true,
            serverSorting: true,
            error: studio.ui.handleAjaxError,
            schema: {
              data: "items",
              total: "totalCount",
              model: AlbumModel
            }
          });
          renderTo.kendoListView({
            autoBind: false,
            dataSource: dataSource,
            template: kendo.template($("#listview-album-template").html()),
            dataBound: function () {
              var delay = 500;
              renderTo.find("img[is-secure]").each(function () {
                var $this = $(this);
                delay = delay + 100;
                $this.parent().addClass('is-loading');
                studio.ui.setSecureImage($this, delay);
              });
              msnry = studio.ui.masonry(renderTo, {});
            }
          });
          $("#listview-pager").kendoPager({
            dataSource: dataSource,
            pageSizes: [54, 108, 162],
            refresh: true,
            responsive: true
          });
          renderTo.on("click", "a[data-action=edit]", function (e) {
            var $this = $(this);
            if (studio.ui.defined($this.data("object-id"))) {
              var objectId = $this.data("object-id");
              var dataItem = dataSource.get(objectId);
              getAlbumWindow(dataItem);
            }
          });
          dataSource.read();
        }
      </script>
      <main class='main-content'>
        <div id='mainContent'>
          <div class="full-container bgc-grey-100">
            <!-- Top -->
            <div class="layer w-100 g-pa-15">
              <div class="peers ai-c jc-sb fxw-nw">
                <div class="peer">
                </div>
                <div class="peer">
                  <a class="btn btn-link u-link-v5 g-mr-10 g-font-size-15 g-color-secondary--hover"
                    data-bind="click:upload">

                    <svg class="bi bi-cloud-upload" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor"
                      xmlns="http://www.w3.org/2000/svg">
                      <path
                        d="M4.887 6.2l-.964-.165A2.5 2.5 0 1 0 3.5 11H6v1H3.5a3.5 3.5 0 1 1 .59-6.95 5.002 5.002 0 1 1 9.804 1.98A2.501 2.501 0 0 1 13.5 12H10v-1h3.5a1.5 1.5 0 0 0 .237-2.981L12.7 7.854l.216-1.028a4 4 0 1 0-7.843-1.587l-.185.96z" />
                      <path fill-rule="evenodd"
                        d="M5 8.854a.5.5 0 0 0 .707 0L8 6.56l2.293 2.293A.5.5 0 1 0 11 8.146L8.354 5.5a.5.5 0 0 0-.708 0L5 8.146a.5.5 0 0 0 0 .708z" />
                      <path fill-rule="evenodd" d="M8 6a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0v-8A.5.5 0 0 1 8 6z" />
                    </svg>
                    Upload Images</a>

                  <a class="btn btn-link u-link-v5 g-mr-10 g-font-size-15 g-color-secondary--hover"
                    data-bind="click:create">
                    <svg class="bi bi-images" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor"
                      xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd"
                        d="M12.002 4h-10a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1zm-10-1a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-10z">
                      </path>
                      <path
                        d="M10.648 8.646a.5.5 0 0 1 .577-.093l1.777 1.947V14h-12v-1l2.646-2.354a.5.5 0 0 1 .63-.062l2.66 1.773 3.71-3.71z">
                      </path>
                      <path fill-rule="evenodd"
                        d="M4.502 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM4 2h10a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1v1a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2h1a1 1 0 0 1 1-1z">
                      </path>
                    </svg>
                    <spin class="g-ml-5 g-font-size-12 g-font-weight-300">
                      New Photo Album</spin>
                  </a>
                </div>
              </div>
            </div>
            <!-- End Top -->


            <div id="masonry-listview" class="masonry"></div>
            <div id="masonry-pager" class="k-pager-wrap g-brd-0 w-100"></div>
            <!--
            <div id="album-listview">
              <div id="listview" class="row" style="border:0;width:100%;"></div>
              <div id="listview-pager" class="k-pager-wrap g-brd-0" style="width:100%;"></div>
            </div> 
          -->
          </div>
        </div>
      </main>
      <span id="dialog"></span>
      <div id="upload-window" class="g-pa-15 g-height-300 container-fluid bgc-grey-100" style="display:none;">
        <!-- Dropdown -->
        <form action="" method="post" enctype="multipart/form-data" id="image-file-dropzone"
          class="u-dropzone u-file-attach-v3 dz-clickable g-rounded-50 g-pa-20">
          <div class="dz-default dz-message">
            <p>
              <img
                src="data:image/png;base64,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">
            </p>
            <h3 class="g-font-size-14 g-font-weight-400 g-color-gray-dark-v2 mb-0">Drag the image files to upload here
              <span class="g-color-primary">Drag &amp; Drop</span>. <br /> Or click to select a file.</h3>
            <p class="g-font-size-12 g-color-gray-light-v2 mb-0">The maximum file size is 10MB.</p>
          </div>
          <div class="dropzone-previews"></div>
        </form>
        <!-- End Dropdown -->
      </div>
      <div id="album-window" class="g-pa-0 g-height-600 container-fluid bgc-grey-100" style="display:none;">
        <div class="row no-gutters">
          <div class="col-md-8 bgc-grey-100">
            <div id="album-image-grid" class="g-brd-0 tab-pane-grid g-height-600" data-bind="visible:editable"></div>
          </div>
          <div class="col-md-4" style="border-left: solid 1px #ddd;">
            <form class="g-pa-15 g-height-300">
              <div class="form-group">
                <input type="text" class="form-control form-control-md g-rounded-4 g-px-14 g-py-10"
                  data-bind="value:album.name" placeholder="Add Title">
              </div>
              <div class="form-group">
                <textarea class="form-control form-control-md g-rounded-4 g-px-14 g-py-10" rows="3"
                  data-bind="value:album.description" placeholder="Description"></textarea>
              </div>
              <div class="text-right">
                <a href="#" class="btn u-btn-darkgray g-mr-10 g-mb-15" data-bind="click:saveOrUpdate">Save</a>
              </div>
            </form>

            <!-- Dropdown -->
            <form action="" method="post" enctype="multipart/form-data" id="album-image-file-dropzone"
            class="u-dropzone u-file-attach-v3 dz-clickable g-rounded-50 g-pa-20 g-ma-20">
            <div class="dz-default dz-message">
              <p>
                <img
                  src="data:image/png;base64,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">
              </p>
              <h3 class="g-font-size-14 g-font-weight-400 g-color-gray-dark-v2 mb-0">Drag the image files to upload here
                <span class="g-color-primary">Drag &amp; Drop</span>. <br /> Or click to select a file.</h3>
              <p class="g-font-size-12 g-color-gray-light-v2 mb-0">The maximum file size is 10MB.</p>
            </div>
            <div class="dropzone-previews"></div>
          </form>
          <!-- End Dropdown --> 

          </div>
        </div>
      </div>

      <div id="image-broswer-window" class="g-height-600 g-pa-0 g-bg-gray-light-v5" style="display:none;">
        <div class="container">
          <div class="row">
            <div class="border-0 grid"></div>
          </div>
        </div>
      </div>
      <script type="text/x-kendo-template" id="imagebroswer-toolbar-template">
        <div class="layer w-100">
          <div class="peers ai-c jc-sb fxw-nw">
            <div class="peer">     
              <svg class="bi bi-tag" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M.5 2A1.5 1.5 0 0 1 2 .5h4.586a1.5 1.5 0 0 1 1.06.44l7 7a1.5 1.5 0 0 1 0 2.12l-4.585 4.586a1.5 1.5 0 0 1-2.122 0l-7-7A1.5 1.5 0 0 1 .5 6.586V2zM2 1.5a.5.5 0 0 0-.5.5v4.586a.5.5 0 0 0 .146.353l7 7a.5.5 0 0 0 .708 0l4.585-4.585a.5.5 0 0 0 0-.708l-7-7a.5.5 0 0 0-.353-.146H2z"/>
                <path fill-rule="evenodd" d="M2.5 4.5a2 2 0 1 1 4 0 2 2 0 0 1-4 0zm2-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
              </svg>
              <select id="tags" style="width:300px;"></select>        
            </div>
            <div class="peer">
              <button type="button" class="btn cur-p u-btn-pink" data-bind="enabled:selected, click:select" >
              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-plus" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M8 3.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5H4a.5.5 0 0 1 0-1h3.5V4a.5.5 0 0 1 .5-.5z"/>
                <path fill-rule="evenodd" d="M7.5 8a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0V8z"/>
              </svg>
              <spin class="g-ml-5 g-font-size-12 g-font-weight-300">
                Select</spin>
            </button>              
            </div>
          </div>
        </div>          
      </script>
      <script type="text/x-kendo-template" id="imagebroswer-user-column-template">
        <div class="media">
          <div class="d-flex align-self-center">
            <img class="g-width-36 g-height-36 g-rounded-50 g-mr-15" src="#= studio.services.accounts.getUserAvatarUrl( user.username ) #" >
          </div>
          <div class="media-body align-self-center text-left">#if ( !user.anonymous  && user.name != null ) {# #: user.name # #}#</div>
        </div>	
        </script>
      <script type="text/x-kendo-template" id="imagebroswer-image-column-template">
      <!-- Figure Image -->
      <div class="g-width-100 g-width-" 100--md g-width-100 g-height-100--md g-brd-2 g-brd-transparent
        g-brd-lightblue-v3--parent-opened g-mr-20--sm">
        <figure class="g-pos-rel u-bg-overlay g-bg-black-opacity-0_1--after g-overflow-hidden">
          <img
            class="g-width-100 g-width-100--md g-width-100 g-height-100--md g-brd-2 g-brd-transparent g-brd-lightblue-v3--parent-opened g-mr-20--sm"
            #if (imageLink==null) { # data-retry="0" is-secure="true" data-max-retry="3"
            secure-image="#= studio.ui.getImageUrl(data, {thumbnail:true}) #" src="assets/static/images/no-image_2.jpg" #}else{# 
            src="#= studio.ui.getImageUrl(data, {thumbnail:true}) #"   
          #}# alt="#= name #">
        </figure>
      </div>
      <!-- Figure Image -->
      </script>

      <script type="text/x-kendo-template" id="listview-album-template">
        <div class="k-card g-pa-0 g-ma-5 masonry-item" >
          <div class="k-card-header k-display-flex k-align-items-center bgc-grey-100">
            <h5 class="k-card-title g-font-size-14">#:name#</h5> 
          </div>
          <a style="overflow:hidden;" href="albums.html?#=albumId#" target="_self" >
          <img class="k-card-image"
          # if (coverImage!=null) { #
            data-retry="0" is-secure="true" data-max-retry="5"
            secure-image="#= studio.ui.getImageUrl(coverImage, { width:300, height:300, thumbnail:true }) #"
            src="#= studio.ui.getImageUrl(coverImage, { width:300, height:300, thumbnail:true }) #"
          # }else{ # src = "assets/static/images/no-image_2.jpg" #}# /> 
          </a>
          <div class="k-card-body">
            <h6 class="k-card-subtitle">#= studio.ui.format.date( modifiedDate ,"yyyy.MM.dd HH:mm")  #  
            </h6>
            <p>#: description #</p>
          </div>
          <div class="k-card-actions"> 
          <div class="layer w-100">
            <div class="peers ai-c jc-sb fxw-nw">
              <div class="peer">
                <div class="media">
                  <div class="d-flex align-self-center">
                    <img class="g-width-24 g-height-24 rounded-circle g-mr-15" src="#= studio.services.accounts.getUserAvatarUrl( user.username ) #" alt="#if ( !user.anonymous && user.name != null ) {# #: user.name # #}#" >
                  </div>
                </div> 
              </div>
              <div class="peer">
                <a class="btn btn-link u-link-v5 g-mr-5 g-font-size-15 g-color-secondary--hover" 
                data-bind="click:create">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chat-left" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M14 1H2a1 1 0 0 0-1 1v11.586l2-2A2 2 0 0 1 4.414 11H14a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                </svg> 
              </a> 
              <a class="btn btn-link u-link-v5 g-font-size-15 g-color-secondary--hover g-text-right" data-action="edit" data-object-id="#=albumId#">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-pencil" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M11.293 1.293a1 1 0 0 1 1.414 0l2 2a1 1 0 0 1 0 1.414l-9 9a1 1 0 0 1-.39.242l-3 1a1 1 0 0 1-1.266-1.265l1-3a1 1 0 0 1 .242-.391l9-9zM12 2l2 2-9 9-3 1 1-3 9-9z"/>
                  <path fill-rule="evenodd" d="M12.146 6.354l-2.5-2.5.708-.708 2.5 2.5-.707.708zM3 10v.5a.5.5 0 0 0 .5.5H4v.5a.5.5 0 0 0 .5.5H5v.5a.5.5 0 0 0 .5.5H6v-1.5a.5.5 0 0 0-.5-.5H5v-.5a.5.5 0 0 0-.5-.5H3z"/>
                </svg> 
              </a> 
              </div>
            </div>
          </div> 
          </div>
        </div>
      </script>
      <script type="text/x-kendo-template" id="gallery-toolbar-template">
        <div class="layer w-100">
          <div class="peers ai-c jc-sb fxw-nw">
            <div class="peer">
              <a class="btn btn-link u-link-v5 g-mr-10 g-font-size-15 g-color-secondary--hover"
              data-bind="click:select, visible:editable">
              <svg class="bi bi-plus" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor"
                xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd"
                  d="M8 3.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5H4a.5.5 0 0 1 0-1h3.5V4a.5.5 0 0 1 .5-.5z" />
                <path fill-rule="evenodd" d="M7.5 8a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0V8z" />
              </svg>
              <spin class="g-ml-5 g-font-size-12 g-font-weight-300">
                Add to album</spin>
            </a>              
            </div>
            <div class="peer">
              <a class="btn btn-link u-link-v5 g-mr-10 g-font-size-15 g-color-secondary--hover"
              data-bind="click:saveOrUpdateImages, visible:editable">
              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-check2" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
              </svg>
              <spin class="g-ml-5 g-font-size-12 g-font-weight-300">
                Save</spin>
            </a>              
            </div>
          </div>
        </div>          
      </script>
      <script type="text/x-kendo-template" id="order-column-template">
      <!-- Figure Image -->
      <div class="g-width-100 g-width-" 100--md g-width-100 g-height-100--md g-brd-2 g-brd-transparent
        g-brd-lightblue-v3--parent-opened g-mr-20--sm">
        <a class="fancybox" is-secure="true" data-fancybox="gallery" href="#= studio.ui.getImageUrl(data) #"
          data-caption="#if (tags !=null && tags.length>0 ) {#<span class='u-label g-rounded-3 g-bg-pink g-mr-10 g-mb-15'><i class='fa fa-tags g-mr-3'></i>#: tags #</span>#}#
          <br/> 
          #: name #  #= studio.ui.format.byte( size ) # #= studio.ui.format.date( modifiedDate , 'yyyy.MM.dd HH:MM') #">
          <figure class="g-pos-rel u-bg-overlay g-bg-black-opacity-0_1--after g-overflow-hidden">
            <img
              class="g-width-100 g-width-100--md g-width-100 g-height-100--md g-brd-2 g-brd-transparent g-brd-lightblue-v3--parent-opened g-mr-20--sm"
              #if (imageLink==null) { # data-retry="0" is-secure="true"
              secure-image="#= studio.ui.getImageUrl(data, {thumbnail:true}) #"
              src="assets/static/images/no-image_2.jpg" #}else{# 
          src="#= studio.ui.getImageUrl(data, {thumbnail:true}) #"   
          #}# alt="#= name #">
          </figure>
        </a>
      </div>
      <!-- Figure Image -->
      </script>
      <script type="text/x-kendo-template" id="name-column-template">
      <h5 class="g-font-weight-300 g-mb-5">
              #if ( imageLink!=null && imageLink.publicShared ) { #
              <svg class="bi bi-unlock c-red-500" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M9.655 8H2.333c-.264 0-.398.068-.471.121a.73.73 0 0 0-.224.296 1.626 1.626 0 0 0-.138.59V14c0 .342.076.531.14.635.064.106.151.18.256.237a1.122 1.122 0 0 0 .436.127l.013.001h7.322c.264 0 .398-.068.471-.121a.73.73 0 0 0 .224-.296 1.627 1.627 0 0 0 .138-.59V9c0-.342-.076-.531-.14-.635a.658.658 0 0 0-.255-.237A1.122 1.122 0 0 0 9.655 8zm.012-1H2.333C.5 7 .5 9 .5 9v5c0 2 1.833 2 1.833 2h7.334c1.833 0 1.833-2 1.833-2V9c0-2-1.833-2-1.833-2zM8.5 4a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z"/>
              </svg>
      # } else {# 
              <svg class="bi bi-lock c-red-500" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M11.5 8h-7a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1zm-7-1a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-7zm0-3a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z"/>
              </svg>
              #}# #= name # 
      </h5> 
      </script>
      <script type="text/x-kendo-template" id="command-column-template">
        <a class="btn btn-link u-link-v5 g-mr-10 g-font-size-15 g-color-secondary--hover" data-action="top" data-object-id="#= imageId #" >
          <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-double-up" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M7.646 2.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 3.707 2.354 9.354a.5.5 0 1 1-.708-.708l6-6z"/>
            <path fill-rule="evenodd" d="M7.646 6.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 7.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/>
          </svg>
          <spin class="g-ml-5 g-font-size-12 g-font-weight-300">
            Move to top</spin>
        </a>
        <button type="button" class="btn cur-p u-btn-pink" data-action="remove" data-object-id="#= imageId #">
          <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-x" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M11.854 4.146a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708-.708l7-7a.5.5 0 0 1 .708 0z"></path>
            <path fill-rule="evenodd" d="M4.146 4.146a.5.5 0 0 0 0 .708l7 7a.5.5 0 0 0 .708-.708l-7-7a.5.5 0 0 0-.708 0z"></path>
          </svg>
          Remove
        </button>
      </script>
      <!-- ### $App Screen Footer ### -->
    </div>
  </div>
</body>

</html>